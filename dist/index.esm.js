import t from"md5";import n from"jsonwebtoken";function e(){return(e=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t}).apply(this,arguments)}var o=function(){function t(){this.state=new Map}var n=t.prototype;return n.set=function(t,n){this.state.set(t,n)},n.get=function(t){return this.state.get(t)||null},n.delete=function(t){this.state.delete(t)},t}(),i=function(t){return new Promise(function(n){t.text().then(function(e){n({status:t.status,ok:t.ok,json:""!==e?JSON.parse(e):"{}"})})})},r=function(){function r(t){this.config=t,this.storage=new o}var s=r.prototype;return s.authenticate=function(n,e,o,r){var s=this,c=this.config,a=r||t(n+":"+e),u=function(t,n,e){if(!t.host)throw new Error("You have not specifiend an API host");return new Promise(function(o,r){fetch(t.host+"/"+t.authEndpoint,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:{credentials:n,account_name:e}})}).then(i).then(function(t){t.ok&&o(t.json),r(t.json)}).catch(function(t){return r(t)})})}(c,a,o);return u.then(function(t){s.storage.set("credentials",{authToken:t.auth_token,credentials:a,accountId:t.data.account_id,currentAccountId:t.data.account_id,accountName:o})}).catch(function(){}),u},s.sendRequest=function(t,e){var o=this,r=this.config;return new Promise(function(s,c){var a=o.storage.get("credentials")||{};return function(t){try{n.decode(t),Math.ceil((new Date).getTime()/1e3)}catch(t){return!0}}(a.authToken),function(n){var o=n.authToken,a=n.currentAccountId;o&&a||c("User has not been authorized"),fetch(r.host+"/accounts/"+a+"/"+t,{method:e,headers:{"X-Auth-Token":o,"Content-Type":"application/json"}}).then(i).then(function(t){t.ok&&s(t.json),c(t.json)}).catch(function(t){return c(t)})}(a)})},s.masquerade=function(t){var n=this.storage.get("credentials");this.storage.set("credentials",e({},n,{currentAccountId:t}))},s.stopMasquerading=function(){var t=this.storage.get("credentials");this.storage.set("credentials",e({},t,{currentAccountId:t.accountId}))},r}(),s=function(t){var n=t.authEndpoint;this.host=t.host,this.authEndpoint=null!=n?n:"desktop_auth"},c=function(){function t(t){this.endpoint="conferences",this.api=t}return t.prototype.get=function(){return this.call=this.api.sendRequest(this.endpoint,"GET"),this.call},t}(),a=function(){function t(t){this.endpoint="users",this.api=t}return t.prototype.get=function(){return this.call=this.api.sendRequest(this.endpoint,"GET"),this.call},t}(),u=function(){function t(t){this.config=t,this.api=new r(t),this.Conferences=new c(this.api),this.Users=new a(this.api)}return t.prototype.authenticate=function(t,n,e,o){return this.api.authenticate(t,n,e,o)},t}(),h=function(t){return new u(new s(t))};export{h as sdk};
//# sourceMappingURL=index.esm.js.map
