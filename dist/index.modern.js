import t from"md5";import n from"jsonwebtoken";function e(){return(e=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t}).apply(this,arguments)}function i(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,o(t,n)}function o(t,n){return(o=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var r=function(){function t(){this.state=new Map}var n=t.prototype;return n.set=function(t,n){this.state.set(t,n)},n.get=function(t){return this.state.get(t)||null},n.delete=function(t){this.state.delete(t)},t}(),a=function(t){return new Promise(function(n){t.text().then(function(e){n({status:t.status,ok:t.ok,json:""!==e?JSON.parse(e):"{}"})})})},c=function(){function i(t){this.config=t,this.storage=new r}var o=i.prototype;return o.authenticate=function(n,e,i,o){var r=this,c=this.config,s=o||t(n+":"+e),u=function(t,n,e){if(!t.host)throw new Error("You have not specifiend an API host");return new Promise(function(i,o){fetch(t.host+"/"+t.authEndpoint,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:{credentials:n,account_name:e}})}).then(a).then(function(t){t.ok&&i(t.json),o(t.json)}).catch(function(t){return o(t)})})}(c,s,i);return u.then(function(t){r.storage.set("credentials",{authToken:t.auth_token,credentials:s,accountId:t.data.account_id,currentAccountId:t.data.account_id,accountName:i})}).catch(function(){}),u},o.sendRequest=function(t,i,o){var r=this;void 0===o&&(o=null);var c=this.config;return new Promise(function(s,u){var h=r.storage.get("credentials")||{},f=function(n){var r=n.authToken,h=n.currentAccountId;r&&h||u("User has not been authorized"),fetch(c.host+"/accounts/"+h+"/"+t,e({method:i,headers:{"X-Auth-Token":r,"Content-Type":"application/json"}},o&&{body:JSON.stringify({data:o})})).then(a).then(function(t){t.ok&&s(t.json),u(t.json)}).catch(function(t){return u(t)})};return function(t){try{var e=n.decode(t).exp,i=void 0===e?null:e;return Math.ceil((new Date).getTime()/1e3)>=i-10}catch(t){return!0}}(h.authToken)?r.authenticate("","",h.accountName,h.credentials).then(function(){return f(r.storage.get("credentials"))}).catch(function(t){return u(t)}):f(h)})},o.masquerade=function(t){var n=this.storage.get("credentials");this.storage.set("credentials",e({},n,{currentAccountId:t}))},o.stopMasquerading=function(){var t=this.storage.get("credentials");this.storage.set("credentials",e({},t,{currentAccountId:t.accountId}))},i}(),s=function(t){var n=t.authEndpoint;this.host=t.host,this.authEndpoint=null!=n?n:"desktop_auth"},u=function(){function t(t){this.api=t}var n=t.prototype;return n.get=function(t){return this.call=this.api.sendRequest((n=this.endpoint,(i=t||{}).paginate?n+"?"+function(t){var n=t.paginate,i={};return t.hasOwnProperty("paginate")&&(i=e({},i,{paginate:n})),Object.keys(i).map(function(t){return function(t,n){return t+"="+n}(t,i[t])}).join("&")}(i):n),"GET"),this.call;var n,i},n.getById=function(t){return this.call=this.api.sendRequest(this.endpoint+"/"+t,"GET"),this.call},n.update=function(t,n){return this.call=this.api.sendRequest(this.endpoint+"/"+t,"PATCH",n),this.call},t}(),h=function(t){function n(n){var e;return(e=t.call(this,n)||this).endpoint="conferences",e}return i(n,t),n.prototype.get=function(){return this.call=this.api.sendRequest(this.endpoint,"GET"),this.call},n}(u),f=function(t){function n(n){var e;return(e=t.call(this,n)||this).endpoint="devices",e}return i(n,t),n}(u),p=function(t){function n(n){var e;return(e=t.call(this,n)||this).endpoint="users",e}return i(n,t),n}(u),d=function(){function t(t){this.config=t,this.api=new c(t),this.Conferences=new h(this.api),this.Devices=new f(this.api),this.Users=new p(this.api)}return t.prototype.authenticate=function(t,n,e,i){return this.api.authenticate(t,n,e,i)},t}(),l=function(t){return new d(new s(t))};export{l as sdk};
//# sourceMappingURL=index.modern.js.map
